{% extends 'base.html' %} {% block title %}Dashboard - Vehicle Identity System{%
endblock %} {% block page_title %}Dashboard{% endblock %} {% block content %}
<!-- Statistics Cards -->
<div class="row mb-4">
  <div class="col-md-3">
    <div class="card stat-card">
      <div class="card-body d-flex align-items-center">
        <div class="icon-box bg-primary bg-opacity-10 text-primary me-3">
          <i class="fas fa-car"></i>
        </div>
        <div>
          <h6 class="text-muted mb-1">Total Identities</h6>
          <h3 class="mb-0">{{ total_identities }}</h3>
        </div>
      </div>
    </div>
  </div>
  <div class="col-md-3">
    <div class="card stat-card">
      <div class="card-body d-flex align-items-center">
        <div class="icon-box bg-success bg-opacity-10 text-success me-3">
          <i class="fas fa-check-circle"></i>
        </div>
        <div>
          <h6 class="text-muted mb-1">Verified</h6>
          <h3 class="mb-0">{{ verified_count }}</h3>
        </div>
      </div>
    </div>
  </div>
  <div class="col-md-3">
    <div class="card stat-card">
      <div class="card-body d-flex align-items-center">
        <div class="icon-box bg-warning bg-opacity-10 text-warning me-3">
          <i class="fas fa-exclamation-triangle"></i>
        </div>
        <div>
          <h6 class="text-muted mb-1">Unverified</h6>
          <h3 class="mb-0">{{ unverified_count }}</h3>
        </div>
      </div>
    </div>
  </div>
  <div class="col-md-3">
    <div class="card stat-card">
      <div class="card-body d-flex align-items-center">
        <div class="icon-box bg-info bg-opacity-10 text-info me-3">
          <i class="fas fa-eye"></i>
        </div>
        <div>
          <h6 class="text-muted mb-1">Observations</h6>
          <h3 class="mb-0">{{ total_observations }}</h3>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="row">
  <!-- Recent Observations -->
  <div class="col-md-8">
    <div class="card">
      <div
        class="card-header bg-white d-flex justify-content-between align-items-center"
      >
        <h6 class="mb-0">Recent Observations</h6>
        <a
          href="{{ url_for('admin.observations_list') }}"
          class="btn btn-sm btn-outline-primary"
          >View All</a
        >
      </div>
      <div class="card-body">
        <div class="table-responsive">
          <table class="table table-hover">
            <thead>
              <tr>
                <th>Time</th>
                <th>Plate</th>
                <th>Type</th>
                <th>Source</th>
                <th>OCR</th>
                <th>Action</th>
              </tr>
            </thead>
            <tbody>
              {% for obs in recent_observations %}
              <tr>
                <td>
                  {{ obs.timestamp.strftime('%d/%m %H:%M') if obs.timestamp else
                  '-' }}
                </td>
                <td>
                  {% if obs.plate_text %}
                  <strong>{{ obs.plate_text }}</strong>
                  {% else %}
                  <span class="badge badge-ocr-failed">No Plate</span>
                  {% endif %}
                </td>
                <td>
                  <span class="badge bg-secondary"
                    >{{ obs.vehicle_type or 'Unknown' }}</span
                  >
                </td>
                <td>
                  <span class="badge bg-info"
                    >{{ obs.source_type or 'image' }}</span
                  >
                </td>
                <td>
                  {% if obs.ocr_success %}
                  <span class="badge badge-ocr-success"
                    >{{ (obs.plate_confidence * 100)|round|int }}%</span
                  >
                  {% else %}
                  <span class="badge badge-ocr-failed">Failed</span>
                  {% endif %}
                </td>
                <td>
                  <a
                    href="{{ url_for('admin.vehicle_detail', id=obs.vehicle_id) }}"
                    class="btn btn-sm btn-outline-primary"
                  >
                    <i class="fas fa-eye"></i>
                  </a>
                </td>
              </tr>
              {% else %}
              <tr>
                <td colspan="6" class="text-center text-muted">
                  No observations yet
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

  <!-- Charts -->
  <div class="col-md-4">
    <!-- Identity Method Chart -->
    <div class="card mb-4">
      <div class="card-header bg-white">
        <h6 class="mb-0">Identity Method</h6>
      </div>
      <div class="card-body">
        <canvas id="methodChart" height="200"></canvas>
      </div>
    </div>

    <!-- Vehicle Type Chart -->
    <div class="card">
      <div class="card-header bg-white">
        <h6 class="mb-0">Vehicle Types</h6>
      </div>
      <div class="card-body">
        <canvas id="typeChart" height="200"></canvas>
      </div>
    </div>
  </div>
</div>

<!-- Quick Actions -->
<div class="row mt-4">
  <div class="col-12">
    <div class="card">
      <div class="card-header bg-white">
        <h6 class="mb-0">Quick Actions</h6>
      </div>
      <div class="card-body">
        <div class="row g-3">
          <div class="col-md-3">
            <a href="{{ url_for('api.index') }}" class="btn btn-primary w-100">
              <i class="fas fa-upload me-2"></i> Upload Image
            </a>
          </div>
          <div class="col-md-3">
            <a
              href="{{ url_for('api.video_ui') }}?source=webcam"
              class="btn btn-success w-100"
            >
              <i class="fas fa-video me-2"></i> Start Webcam
            </a>
          </div>
          <div class="col-md-3">
            <a
              href="{{ url_for('admin.vehicles_list') }}?status=unverified"
              class="btn btn-warning w-100"
            >
              <i class="fas fa-tasks me-2"></i> Review Unverified
            </a>
          </div>
          <div class="col-md-3">
            <a
              href="{{ url_for('admin.merge_page') }}"
              class="btn btn-info w-100"
            >
              <i class="fas fa-code-branch me-2"></i> Merge/Split
            </a>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %} {% block extra_js %}
<script>
  // Identity Method Chart
  const methodCtx = document.getElementById('methodChart').getContext('2d');
  new Chart(methodCtx, {
      type: 'doughnut',
      data: {
          labels: ['Plate OCR', 'Face Recognition', 'Visual Features'],
          datasets: [{
              data: [{{ plate_based }}, {{ face_based }}, {{ visual_based }}],
              backgroundColor: ['#1e40af', '#7c3aed', '#6b7280']
          }]
      },
      options: {
          responsive: true,
          plugins: {
              legend: {
                  position: 'bottom'
              }
          }
      }
  });

  // Vehicle Type Chart
  const typeCtx = document.getElementById('typeChart').getContext('2d');
  new Chart(typeCtx, {
      type: 'bar',
      data: {
          labels: [{% for t, c in type_stats %}'{{ t or "Unknown" }}'{% if not loop.last %}, {% endif %}{% endfor %}],
          datasets: [{
              label: 'Count',
              data: [{% for t, c in type_stats %}{{ c }}{% if not loop.last %}, {% endif %}{% endfor %}],
              backgroundColor: '#3b82f6'
          }]
      },
      options: {
          responsive: true,
          plugins: {
              legend: {
                  display: false
              }
          },
          scales: {
              y: {
                  beginAtZero: true
              }
          }
      }
  });
</script>
{% endblock %}
